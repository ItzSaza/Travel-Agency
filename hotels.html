<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hotels | GoTrip</title>
  <link rel="stylesheet" href="hotels_Styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-white sticky-top border-bottom">
    <div class="container">
      <a class="navbar-brand fw-semibold d-flex align-items-center" href="index.html">
        <i class="bi bi-compass text-primary me-2"></i> GoTrip
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">Guides</a></li>
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="hotels.html">Hotels</a></li>
          <li class="nav-item"><a class="nav-link" href="destination.html">Destinations</a></li>
          <li class="nav-item"><a class="nav-link" href="travellingmethods.html">Travelling Methods</a></li>
          <li class="nav-item"><a class="nav-link" href="trainreservations.html">Train Reservations</a></li>
        </ul>

        <div class="d-flex gap-2">
          <a href="login.html" class="btn btn-outline-secondary btn-sm"><i class="bi bi-box-arrow-in-right me-1"></i>Login</a>
          <a class="btn btn-primary btn-sm" onclick="location.href='register.html'"><i class="bi bi-person-plus me-1"></i>Sign Up</a>
        </div>
      </div>
    </div>
  </nav>

  <header class="hero border-bottom text-center py-5">
    <div class="container">
      <h1 class="display-6 fw-semibold mb-2">Hotels in Sri Lanka</h1>
      <p class="lead text-secondary mb-0">Find recommended hotels by city — curated for comfort and convenience.</p>
    </div>
  </header>

  <main class="container py-5">
    <!-- Kandy -->
    <section class="city-section mb-5">
      <h2>Kandy</h2>
      <div class="row">
        <div class="col-md-4">
          <div class="card hotel-card mb-4">
            <img src="Grand_Serendib_Hotel.jpg" class="card-img-top" alt="Grand Serendib Hotel">
            <div class="card-body">
              <h5 class="card-title">Grand Serendib Hotel</h5>
              <p class="card-text">Comfortable stay close to Kandy city centre with scenic views and modern amenities.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Grand%20Serendib%20Hotel%20Kandy" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card hotel-card mb-4">
            <img src="Kandy_Myst.jpg" class="card-img-top" alt="Kandy Myst">
            <div class="card-body">
              <h5 class="card-title">Kandy Myst</h5>
              <p class="card-text">A boutique option near cultural sites and transport links.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Kandy%20Myst%20Kandy" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card hotel-card mb-4">
            <img src="Earl_Regency.jpg" class="card-img-top" alt="Earl's Regency">
            <div class="card-body">
              <h5 class="card-title">Earl's Regency</h5>
              <p class="card-text">Upscale hotel with pool, restaurants and easy access to Kandy attractions.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Earl%27s%20Regency%20Kandy" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Galle -->
    <section class="city-section mb-5">
      <h2>Galle</h2>
      <div class="row">
        <div class="col-md-4">
          <div class="card hotel-card mb-4">
            <img src="The_Fort_House.jpg" class="card-img-top" alt="The Fort House">
            <div class="card-body">
              <h5 class="card-title">The Fort House</h5>
              <p class="card-text">Charming guesthouse inside Galle Fort with historic character.</p>
              <a href="https://www.booking.com/searchresults.html?ss=The%20Fort%20House%20Galle" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card hotel-card mb-4">
            <img src="Radisson_Collection_Resort.jpg" class="card-img-top" alt="Radisson Collection Resort Galle">
            <div class="card-body">
              <h5 class="card-title">Radisson Collection Resort Galle</h5>
              <p class="card-text">Luxury beachfront resort with excellent facilities for families and couples.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Radisson%20Collection%20Resort%20Galle" target="_blank" rel="noopener" class="btn btn-primary.btn-sm">More info</a>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card hotel-card mb-4">
            <img src="Le_Grand_Galle.jpg" class="card-img-top" alt="Le Grand Galle">
            <div class="card-body">
              <h5 class="card-title">Le Grand Galle</h5>
              <p class="card-text">Elegant hotel close to the fort and coastal attractions.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Le%20Grand%20Galle" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Sigiriya -->
    <section class="city-section mb-5">
      <h2>Sigiriya</h2>
      <div class="row">
        <div class="col-md-6">
          <div class="card hotel-card mb-4">
            <img src="Habarana_Village.jpg" class="card-img-top" alt="Habarana Village by Cinnamon">
            <div class="card-body">
              <h5 class="card-title">Habarana Village by Cinnamon</h5>
              <p class="card-text">Comfortable lodge-style resort close to Sigiriya rock and local sights.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Habarana%20Village%20by%20Cinnamon%20Sigiriya" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card hotel-card mb-4">
            <img src="Heritance_Kandalama.jpg" class="card-img-top" alt="Heritance Kandalama">
            <div class="card-body">
              <h5 class="card-title">Heritance Kandalama</h5>
              <p class="card-text">Iconic design hotel set into the landscape with outstanding views and service.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Heritance%20Kandalama%20Sigiriya" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Nuwara E  liya -->
    <section class="city-section mb-5">
      <h2>Nuwara Eliya</h2>
      <div class="row">
        <div class="col-md-6">
          <div class="card hotel-card mb-4">
            <img src="The_Golden_Ridge_Hotel.jpg" class="card-img-top" alt="The Golden Ridge Hotel">
            <div class="card-body">
              <h5 class="card-title">The Golden Ridge Hotel</h5>
              <p class="card-text">Cozy hotel in the cool hill country — near tea estates and parks.</p>
              <a href="https://www.booking.com/searchresults.html?ss=The%20Golden%20Ridge%20Hotel%20Nuwara%20Eliya" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card hotel-card mb-4">
            <img src="Araliya_Green_City.jpg" class="card-img-top" alt="Araliya Green City">
            <div class="card-body">
              <h5 class="card-title">Araliya Green City</h5>
              <p class="card-text">Comfortable option close to Nuwara Eliya town and attractions.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Araliya%20Green%20City%20Nuwara%20Eliya" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Ella -->
    <section class="city-section mb-5">
      <h2>Ella</h2>
      <div class="row">
        <div class="col-md-6">
          <div class="card hotel-card mb-4">
            <img src="Hotel_Onrock.jpg" class="card-img-top" alt="Hotel Onrock">
            <div class="card-body">
              <h5 class="card-title">Hotel Onrock</h5>
              <p class="card-text">Modern hotel with great views of the valley and close to Ella's sights.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Hotel%20Onrock%20Ella" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card hotel-card mb-4">
            <img src="Heart_of_Ella.jpg" class="card-img-top" alt="Heart of Ella">
            <div class="card-body">
              <h5 class="card-title">Heart of Ella</h5>
              <p class="card-text">Small comfortable stay in the heart of Ella village.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Heart%20of%20Ella" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Anuradhapura -->
    <section class="city-section mb-5">
      <h2>Anuradhapura</h2>
      <div class="row">
        <div class="col-md-6">
          <div class="card hotel-card mb-4">
            <img src="Heritage_Hotel.jpg" class="card-img-top" alt="Heritage Hotel">
            <div class="card-body">
              <h5 class="card-title">Heritage Hotel</h5>
              <p class="card-text">A comfortable base for exploring ancient Anuradhapura.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Heritage%20Hotel%20Anuradhapura" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card hotel-card mb-4">
            <img src="Hotel_Heladiv.jpg" class="card-img-top" alt="Hotel Heladiv">
            <div class="card-body">
              <h5 class="card-title">Hotel Heladiv</h5>
              <p class="card-text">Simple, well-located hotel with good access to historic sites.</p>
              <a href="https://www.booking.com/searchresults.html?ss=Hotel%20Heladiv%20Anuradhapura" target="_blank" rel="noopener" class="btn btn-primary btn-sm">More info</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Add New Hotel Form -->
    <section class="city-section mb-5">
      <h2>Add New Hotel</h2>
      <div class="card">
        <div class="card-body">
          <div id="message"></div>
          <form id="hotelForm" class="needs-validation" novalidate>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="name" class="form-label">Hotel Name *</label>
                <input type="text" class="form-control" id="name" name="name" required>
              </div>
              
              <div class="col-md-6">
                <label for="location" class="form-label">City/Location</label>
                <input type="text" class="form-control" id="location" name="location">
              </div>

              <div class="col-12">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3"></textarea>
              </div>

              <div class="col-12">
                <label for="image" class="form-label">Image URL</label>
                <input type="text" class="form-control" id="image" name="image">
              </div>

              <div class="col-12">
                <button type="submit" class="btn btn-primary">Add Hotel</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- User added hotels (loaded from hotels.json) -->
    <section class="city-section mb-5">
      <h2>User Added Hotels</h2>
      <div class="row" id="userHotelsRow">
        <!-- dynamically injected hotels will appear here -->
      </div>
    </section>

    <div class="text-center mt-4">
      <a href="index.html" class="btn btn-outline-secondary">Back to Home</a>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    document.getElementById('hotelForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);
      const messageDiv = document.getElementById('message');

      try {
        const response = await fetch('add_hotel.php', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (response.ok) {
          messageDiv.className = 'alert alert-success';
          messageDiv.textContent = result.message;
          e.target.reset(); // Clear form

          // If API returned the created hotel, append it immediately
          if (result.hotel) {
            renderHotel(result.hotel, 'userHotelsRow');
          } else {
            // Fallback: reload the list from the server
            loadUserHotels();
          }

          window.scrollTo(0, messageDiv.offsetTop - 20);
        } else {
          messageDiv.className = 'alert alert-danger';
          messageDiv.textContent = result.message || 'Error adding hotel';
        }
      } catch (error) {
        messageDiv.className = 'alert alert-danger';
        messageDiv.textContent = 'Error connecting to server';
      }
    });

    // Helper to render a hotel card into a container row
    function renderHotel(hotel, containerId = 'userHotelsRow') {
      const row = document.getElementById(containerId);
      if (!row) return;

      const col = document.createElement('div');
      col.className = 'col-md-4';

      const card = document.createElement('div');
      card.className = 'card hotel-card mb-4';

      const img = document.createElement('img');
      img.className = 'card-img-top';
      img.alt = hotel.name || '';
      img.src = hotel.image && hotel.image.trim() !== '' ? hotel.image : 'placeholder.jpg';

      const body = document.createElement('div');
      body.className = 'card-body';

      const title = document.createElement('h5');
      title.className = 'card-title';
      title.textContent = hotel.name || 'Untitled';

      const desc = document.createElement('p');
      desc.className = 'card-text';
      desc.textContent = hotel.description || '';

      const link = document.createElement('a');
      link.className = 'btn btn-primary btn-sm';
      const q = encodeURIComponent(hotel.name || '');
      link.href = 'https://www.booking.com/searchresults.html?ss=' + q;
      link.target = '_blank';
      link.rel = 'noopener';
      link.textContent = 'More info';

      body.appendChild(title);
      body.appendChild(desc);

      const btnGroup = document.createElement('div');
      btnGroup.className = 'd-flex gap-2';

      // More info link
      btnGroup.appendChild(link);

      // Delete button (will call API)
      const delBtn = document.createElement('button');
      delBtn.type = 'button';
      delBtn.className = 'btn btn-outline-danger btn-sm';
      delBtn.textContent = 'Delete';
      // store identifying info
      if (hotel.id) delBtn.dataset.id = hotel.id;
      if (hotel.name) delBtn.dataset.name = hotel.name;
      if (hotel.location) delBtn.dataset.location = hotel.location;
      delBtn.addEventListener('click', async function () {
        if (!confirm('Remove "' + (hotel.name || 'this hotel') + '"?')) return;
        // call delete endpoint
        try {
          const payload = {};
          if (this.dataset.id) payload.id = this.dataset.id;
          else {
            payload.name = this.dataset.name || '';
            payload.location = this.dataset.location || '';
          }
          const res = await fetch('delete_hotel.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const json = await res.json();
          if (res.ok) {
            // remove card from DOM
            col.remove();
            showMessage('success', json.message || 'Hotel removed');
          } else {
            showMessage('danger', json.message || 'Failed to remove hotel');
          }
        } catch (err) {
          console.error(err);
          showMessage('danger', 'Error connecting to server');
        }
      });

      btnGroup.appendChild(delBtn);
      body.appendChild(btnGroup);

      card.appendChild(img);
      card.appendChild(body);
      col.appendChild(card);
      row.appendChild(col);
    }

    // Load hotels from the PHP endpoint and render
    async function loadUserHotels() {
      try {
        const res = await fetch('get_hotels.php', { cache: 'no-store' });
        if (!res.ok) return;
        const data = await res.json();
        const row = document.getElementById('userHotelsRow');
        if (!row) return;
        row.innerHTML = '';
        data.forEach(h => renderHotel(h, 'userHotelsRow'));
      } catch (err) {
        console.error('Failed to load hotels', err);
      }
    }

    // Initial load
    loadUserHotels();

    // Small helper to show messages in the Add form area
    function showMessage(type, text) {
      const messageDiv = document.getElementById('message');
      if (!messageDiv) return;
      messageDiv.className = 'alert alert-' + (type === 'success' ? 'success' : 'danger');
      messageDiv.textContent = text;
      // auto-hide after 4s
      setTimeout(() => {
        messageDiv.className = '';
        messageDiv.textContent = '';
      }, 4000);
    }
  </script>
</body>
</html>
</body>
</html>
